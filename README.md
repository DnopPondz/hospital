# ThaiGov Portal

แอป Next.js สำหรับศูนย์บริการดิจิทัลภาครัฐที่มีฟอร์มติดต่อออนไลน์พร้อมระบบส่งอีเมลผ่าน SMTP

> ระบบอีเมลใช้การเชื่อมต่อ SMTP พื้นฐานที่เขียนขึ้นเอง ไม่ต้องติดตั้งไลบรารีเสริมเพิ่ม แต่ยังคงต้องมีข้อมูลเซิร์ฟเวอร์ SMTP ของคุณเองสำหรับส่งอีเมลออก

## การตั้งค่าอีเมลสำหรับฟอร์มติดต่อ

1. คัดลอกไฟล์ตัวอย่างสภาพแวดล้อม:

   ```bash
   cp .env.example .env.local
   ```

2. แก้ไขค่าตัวแปรใน `.env.local` ให้ตรงกับข้อมูล SMTP ของคุณ

   | ตัวแปร | ความหมาย |
   | --- | --- |
   | `SMTP_HOST` | โฮสต์ของเซิร์ฟเวอร์ SMTP เช่น `smtp.gmail.com` |
   | `SMTP_PORT` | พอร์ตของ SMTP (เช่น 587 สำหรับ STARTTLS หรือ 465 สำหรับ SMTPS) |
   | `SMTP_SECURE` | ตั้งค่าเป็น `true` เมื่อใช้การเชื่อมต่อแบบ SMTPS (เช่น พอร์ต 465) |
   | `SMTP_STARTTLS` *(ไม่บังคับ)* | ค่าเริ่มต้นคือ `true` เพื่อสั่งให้เริ่ม STARTTLS หลัง EHLO เมื่อไม่ได้ใช้ SMTPS |
   | `SMTP_USER` | ชื่อผู้ใช้หรืออีเมลที่ใช้เข้าสู่ระบบ SMTP |
   | `SMTP_PASS` | รหัสผ่านของบัญชี SMTP หรือ App Password |
   | `SMTP_FROM` *(ไม่บังคับ)* | อีเมลที่ใช้เป็นผู้ส่ง หากไม่กำหนดจะใช้ `SMTP_USER` |
   | `SMTP_FROM_NAME` *(ไม่บังคับ)* | ชื่อที่ต้องการให้แสดงเป็นผู้ส่ง |
   | `CONTACT_EMAIL_TO` | อีเมลปลายทางที่ต้องการรับข้อความจากฟอร์ม |

   > หากใช้ผู้ให้บริการอย่าง Gmail Workspace ให้ใช้พอร์ต `587`, ตั้ง `SMTP_SECURE=false` และปล่อย `SMTP_STARTTLS=true` (หรือกำหนดไว้ชัดเจน) เพื่อให้ระบบออกคำสั่ง `STARTTLS` ก่อนเข้าสู่ระบบ มิฉะนั้นจะได้รับข้อผิดพลาด `530 5.7.0 Must issue a STARTTLS command first` ตามมาตรฐาน RFC 3207

3. บันทึกไฟล์ `.env.local` และรีสตาร์ทเซิร์ฟเวอร์พัฒนา (ถ้ามีการรันอยู่)

เมื่อกำหนดค่าครบถ้วนแล้ว ฟอร์มติดต่อในหน้าเว็บจะเรียก API `/api/contact` เพื่อส่งอีเมลด้วยข้อมูลที่กรอกมา หากยังไม่ได้ตั้งค่า ระบบจะขึ้นข้อความแจ้งผู้ใช้งานว่าอีเมลยังไม่พร้อมใช้งาน

## การพัฒนา

ติดตั้ง dependencies แล้วรันโหมดพัฒนา:

```bash
npm install
npm run dev
```

## การเชื่อมต่อฐานข้อมูลและคลังภาพ

- **MongoDB**: แอปใช้ฐานข้อมูล MongoDB สำหรับเก็บข่าวและประกาศผ่านคอนเนกชัน `MONGODB_URI` (ค่าเริ่มต้นชี้ไปยังคลัสเตอร์ตัวอย่าง) และชื่อฐานข้อมูล `MONGODB_DB` ซึ่งตั้งเป็น `thaigov_portal` ตามค่าเริ่มต้น
- **Cloudinary**: การอัปโหลดภาพผ่านหน้า LPN จะถูกส่งไปยัง Cloudinary โดยใช้ตัวแปร `CLOUDINARY_CLOUD_NAME`, `CLOUDINARY_API_KEY`, และ `CLOUDINARY_API_SECRET`

ปรับค่าตัวแปรเหล่านี้ใน `.env.local` เพื่อเชื่อมต่อบริการจริงของคุณ

## การทดสอบการส่งอีเมล

หลังจากตั้งค่า SMTP แล้ว สามารถส่งข้อความจากแบบฟอร์มในหน้าเว็บไซต์ (ส่วน "ติดต่อศูนย์บริการภาครัฐ") เพื่อยืนยันว่าระบบส่งอีเมลทำงานได้จริง
